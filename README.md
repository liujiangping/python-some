# 番茄遮阳棚控制决策树算法

## 项目简介

这是一个基于决策树算法的番茄遮阳棚自动控制系统。系统通过分析温度、湿度、光照等环境因素，自动判断是否应该开启遮阳棚，以保护番茄植株免受不利环境条件的影响。

## 算法原理

### 决策树算法
决策树是一种监督学习算法，通过构建树形结构来进行分类或回归预测。本系统使用CART（Classification and Regression Trees）算法构建决策树。

### 核心概念

1. **基尼不纯度（Gini Impurity）**
   - 用于衡量数据集的纯度
   - 基尼不纯度越小，数据越纯
   - 计算公式：Gini = 1 - Σ(p_i²)，其中p_i是第i个类别的概率

2. **特征分割**
   - 遍历所有特征和可能的阈值
   - 选择能够最大程度减少基尼不纯度的分割点
   - 将数据集分为左右两个子集

3. **递归构建**
   - 对每个子集重复分割过程
   - 直到满足停止条件（达到最大深度、样本数太少、数据已纯）

## 遮阳棚控制规则

基于农业经验，系统定义了以下遮阳棚开启条件：

1. **高温条件**：最高温度 > 30°C
2. **强光照条件**：光照时长 > 14小时
3. **低湿度条件**：湿度 < 50%
4. **特殊情况**：温度在25-30°C之间且光照 > 13小时

## 代码结构

### 主要类

#### DecisionTreeNode
决策树节点类，包含：
- `feature`: 分割特征索引（0:温度, 1:湿度, 2:光照）
- `threshold`: 分割阈值
- `left/right`: 左右子树
- `value`: 叶节点的预测值

#### DecisionTree
决策树主类，包含：
- `calculate_gini()`: 计算基尼不纯度
- `split_data()`: 根据特征和阈值分割数据
- `find_best_split()`: 寻找最佳分割点
- `build_tree()`: 递归构建决策树
- `predict()`: 进行预测

### 主要函数

#### load_data(filename)
- 加载CSV格式的番茄生长数据
- 提取特征：最高温度、湿度、光照时长
- 根据农业规则生成标签

#### evaluate_model(model, X_test, y_test)
- 评估模型性能
- 计算准确率、精确率、召回率、F1分数

#### print_tree(node, depth, feature_names)
- 可视化打印决策树结构
- 便于理解决策逻辑

## 使用方法

### 运行程序
```bash
python2 decision-tree.py
```

### 输入数据格式
CSV文件应包含以下列：
- `Max_Temp_C`: 最高温度（摄氏度）
- `Humidity_Percent`: 湿度百分比
- `Sunlight_Hours`: 光照时长（小时）

### 输出结果
程序会输出：
1. 模型性能指标
2. 决策树结构
3. 测试案例的预测结果

## 性能评估

基于2024年番茄生长数据的测试结果：
- **准确率**: 96.67%
- **精确率**: 100.00%
- **召回率**: 92.59%
- **F1分数**: 0.96

## 决策树结构示例

```
如果 光照 < 13.7:
  如果 温度 < 30.2:
    预测: 关闭遮阳棚
  否则:
    预测: 开启遮阳棚
否则:
  如果 温度 < 24.8:
    预测: 关闭遮阳棚
  否则:
    预测: 开启遮阳棚
```

## 算法优势

1. **可解释性强**: 决策树结构清晰，易于理解
2. **计算效率高**: 预测时间复杂度为O(树深度)
3. **处理非线性关系**: 能够捕捉特征间的复杂交互
4. **无需特征缩放**: 对数据预处理要求较低

## 应用场景

1. **智能农业**: 自动控制温室环境
2. **精准农业**: 根据实时环境数据做出决策
3. **农业物联网**: 集成传感器数据进行自动化控制

## 技术特点

- 使用Python2编写，兼容性好
- 最小化第三方库依赖
- 代码注释详细，易于理解和修改
- 支持中文输出，适合国内应用

## 扩展建议

1. **集成实时传感器**: 连接温湿度传感器和光照传感器
2. **多作物支持**: 扩展支持其他作物的遮阳需求
3. **时间序列分析**: 考虑历史天气数据的影响
4. **机器学习优化**: 使用更复杂的算法如随机森林或梯度提升

## 注意事项

1. 决策规则基于农业经验，可能需要根据具体地区调整
2. 建议结合当地气候特点优化参数
3. 定期更新模型以适应气候变化
4. 考虑经济因素，避免过度使用遮阳设施
